$.index.open();

Alloy.Globals.index = $.index;

function updateFetch() {
	Alloy.Collections.house.fetch();
	Alloy.Collections.estate.fetch();
	Alloy.Collections.user.fetch();
}

function getEstateInfo(model) {
	var transform = model.toJSON();
	
	transform.title = transform.Name;
	transform.subtitle = transform.ChineseName;
	transform.id = transform.id;
	transform.rightButton = Titanium.UI.iPhone.SystemButton.DISCLOSURE;
		
	return transform;
}

function showHouses(e) {
	console.log($.index.activeTab);
	if ($.index.activeTab == 1) {
		var housesInEstateController = Alloy.createController("housesInEstate", {
			estate_name: e.row.title
		});
			
		$.index.activeTab.open(housesInEstateController.getView());
	}
	
	if ($.index.activeTab == 3) {
		if (e.clicksource == "rightButton") {
			var housesInEstateController = Alloy.createController("housesInEstate", {
				estate_name: e.annotation.Name
			});
			
			$.index.activeTab.open(housesInEstateController.getView());
		}
	}
}


// function usedEstate(collection) {
// 	
// }

function showHighlight(collection) {
	return collection.filter(function(house) {
		var highlight = house.get("highlight");
		return highlight == "1" || highlight == "true";
	});
}

function showHouseDetails(e) {
	var houseDetailsController = Alloy.createController("houseDetails", {
		house_id: e.row.fid		
	});
	
	$.index.activeTab.open(houseDetailsController.getView());
}

function showCFRHouse() {
	var CFRHouseController = Alloy.createController("CFRHouse");
	
	$.index.activeTab.open(CFRHouseController.getView());
}

function showCMRHouse() {
	var CMRHouseController = Alloy.createController("CMRHouse");
	
	$.index.activeTab.open(CMRHouseController.getView());
}

function showEFRHouse() {
	var EFRHouseController = Alloy.createController("EFRHouse");
	
	$.index.activeTab.open(EFRHouseController.getView());
}

function showEMRHouse() {
	var EMRHouseController = Alloy.createController("EMRHouse");
	
	$.index.activeTab.open(EMRHouseController.getView());
}

var previous = "";

function transformFunction(model) {
	
	var transform = model.toJSON();
	
	if (previous != transform.District) {
		previous = transform.District;
		transform.header = previous;
	}
	return transform;
}
